<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sync data from Firebase to Google sheets</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/img/logo.svg">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/img/logos/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/img/logos/safari-pinned-tab.svg" color="#3eaf7c">
    <link rel="alternate" type="application/rss+xml" href="https://websiddu.com/rss.xml" title="Siddhartha Gudipati RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://websiddu.com/feed.atom" title="Siddhartha Gudipati Atom Feed">
    <link rel="alternate" type="application/json" href="https://websiddu.com/feed.json" title="Siddhartha Gudipati JSON Feed">
    <meta name="description" content="In this blog post I will describe how to sync new data written to a Firebase to Google Sheets. It includes a method for obtaining, storing, and using Oauth2 tokens for Google API access.">
    <meta name="image" content="https://res.cloudinary.com/websiddu/image/upload/v1593528040/blog/013/new-project.png">
    <meta name="twitter:title" content="Sync data from Firebase to Google sheets">
    <meta name="twitter:description" content="In this blog post I will describe how to sync new data written to a Firebase to Google Sheets. It includes a method for obtaining, storing, and using Oauth2 tokens for Google API access.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://res.cloudinary.com/websiddu/image/upload/v1593528040/blog/013/new-project.png">
    <meta name="twitter:url" content="https://websiddu.com/blog/posts/013-sync-firebase-to-google-sheets.html">
    <meta name="twitter:creator" content="@websiddu">
    <meta name="twitter:site" content="@websiddu">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Sync data from Firebase to Google sheets">
    <meta property="og:description" content="In this blog post I will describe how to sync new data written to a Firebase to Google Sheets. It includes a method for obtaining, storing, and using Oauth2 tokens for Google API access.">
    <meta property="og:image" content="https://res.cloudinary.com/websiddu/image/upload/v1593528040/blog/013/new-project.png">
    <meta property="og:url" content="https://websiddu.com/blog/posts/013-sync-firebase-to-google-sheets.html">
    <meta property="og:site_name" content="Siddhartha Gudipati">
    <meta property="article:author" content="Siddhartha Gudipati">
    <meta property="article:published_time" content="May 26, 2020">
    <meta property="article:tag" content="firebase to google sheets">
    <meta itemprop="name" content="Sync data from Firebase to Google sheets">
    <meta itemprop="description" content="In this blog post I will describe how to sync new data written to a Firebase to Google Sheets. It includes a method for obtaining, storing, and using Oauth2 tokens for Google API access.">
    <meta itemprop="image" content="https://res.cloudinary.com/websiddu/image/upload/v1593528040/blog/013/new-project.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#3d5afe">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/img/logos/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#3d5afe">
    <link rel="preload" href="/assets/css/0.styles.6fe59e33.css" as="style"><link rel="preload" href="/assets/js/app.da7058d1.js" as="script"><link rel="preload" href="/assets/js/2.faa5509e.js" as="script"><link rel="preload" href="/assets/js/35.ba935731.js" as="script"><link rel="preload" href="/assets/js/20.e440b549.js" as="script"><link rel="prefetch" href="/assets/js/10.78463937.js"><link rel="prefetch" href="/assets/js/11.166e2cac.js"><link rel="prefetch" href="/assets/js/12.679a44d5.js"><link rel="prefetch" href="/assets/js/13.ddeaa070.js"><link rel="prefetch" href="/assets/js/14.63f60329.js"><link rel="prefetch" href="/assets/js/15.c43e3758.js"><link rel="prefetch" href="/assets/js/16.c3b4e995.js"><link rel="prefetch" href="/assets/js/17.80334dcc.js"><link rel="prefetch" href="/assets/js/18.602b73d8.js"><link rel="prefetch" href="/assets/js/19.d0b6f1ed.js"><link rel="prefetch" href="/assets/js/21.8754582b.js"><link rel="prefetch" href="/assets/js/22.d5bd860d.js"><link rel="prefetch" href="/assets/js/23.2ab19d7f.js"><link rel="prefetch" href="/assets/js/24.3c4fbd65.js"><link rel="prefetch" href="/assets/js/25.f5e20f80.js"><link rel="prefetch" href="/assets/js/26.30ae31d3.js"><link rel="prefetch" href="/assets/js/27.ef46a43e.js"><link rel="prefetch" href="/assets/js/28.f4059904.js"><link rel="prefetch" href="/assets/js/29.2d820bbe.js"><link rel="prefetch" href="/assets/js/3.44bbc4d4.js"><link rel="prefetch" href="/assets/js/30.b03d48ca.js"><link rel="prefetch" href="/assets/js/31.ccdb97fb.js"><link rel="prefetch" href="/assets/js/32.9edf4337.js"><link rel="prefetch" href="/assets/js/33.ca1c709b.js"><link rel="prefetch" href="/assets/js/34.9fe29e1f.js"><link rel="prefetch" href="/assets/js/36.c09c97ae.js"><link rel="prefetch" href="/assets/js/37.9d4a09b7.js"><link rel="prefetch" href="/assets/js/38.ab13e2a6.js"><link rel="prefetch" href="/assets/js/39.816342f5.js"><link rel="prefetch" href="/assets/js/4.46878d81.js"><link rel="prefetch" href="/assets/js/40.ca699137.js"><link rel="prefetch" href="/assets/js/41.57498da7.js"><link rel="prefetch" href="/assets/js/42.21e18e46.js"><link rel="prefetch" href="/assets/js/43.156bd200.js"><link rel="prefetch" href="/assets/js/44.8c035e28.js"><link rel="prefetch" href="/assets/js/45.03ae0f48.js"><link rel="prefetch" href="/assets/js/46.a3932bbb.js"><link rel="prefetch" href="/assets/js/47.9dc47ad7.js"><link rel="prefetch" href="/assets/js/48.159ae1d9.js"><link rel="prefetch" href="/assets/js/49.a8cf396b.js"><link rel="prefetch" href="/assets/js/5.55e428b3.js"><link rel="prefetch" href="/assets/js/50.e4c87a6b.js"><link rel="prefetch" href="/assets/js/51.d559ba25.js"><link rel="prefetch" href="/assets/js/52.7d0f2557.js"><link rel="prefetch" href="/assets/js/53.3c5178c1.js"><link rel="prefetch" href="/assets/js/54.ebd4744b.js"><link rel="prefetch" href="/assets/js/55.11d68665.js"><link rel="prefetch" href="/assets/js/56.9ffff2a2.js"><link rel="prefetch" href="/assets/js/6.c032651f.js"><link rel="prefetch" href="/assets/js/7.e53105dd.js"><link rel="prefetch" href="/assets/js/8.ad1662c3.js"><link rel="prefetch" href="/assets/js/9.015f938d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6fe59e33.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.svg" alt="Siddhartha Gudipati" class="logo"></a> <div class="links" style="max-width:nullpx;"><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">Articles</a></div><div class="nav-item"><a href="/photos/" class="nav-link">Photos</a></div><div class="nav-item"><a href="/projects.html" class="nav-link">Projects</a></div><div class="nav-item"><a href="/about.html" class="nav-link">About</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">Articles</a></div><div class="nav-item"><a href="/photos/" class="nav-link">Photos</a></div><div class="nav-item"><a href="/projects.html" class="nav-link">Projects</a></div><div class="nav-item"><a href="/about.html" class="nav-link">About</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/my-website-is-build-on-open-source.html" class="sidebar-link">My website is build on open-source</a></li><li><a href="/blog/email-that-paved-my-path.html" class="sidebar-link">Email that paved my path</a></li><li><a href="/blog/integrating-your-node-app-with-uw-saml.html" class="sidebar-link">Integrating node apps with UW's SAML</a></li><li><a href="/blog/how-i-implemented-accessibility-to-website.html" class="sidebar-link">How I implemented accessibility for my portfolio website?</a></li><li><a href="/blog/నా-సంతకం-తెలుగు-లో-మరి-మీది.html" class="sidebar-link">నా సంతకం తెలుగు లో మరి మీది?</a></li><li><a href="/blog/questions-i-want-answers-for.html" class="sidebar-link">Questions that I want answers for in life</a></li><li><a href="/blog/morning-thoughts.html" class="sidebar-link">Morning thoughts</a></li><li><a href="/blog/sync-google-sheets-to-firebase.html" class="sidebar-link">Sync data Google sheets to a Firebase</a></li><li><a href="/blog/designing-for-color-blindness.html" class="sidebar-link">Designing for color blindness</a></li><li><a href="/blog/how-to-design-a-ux-portfolio-website-part1.html" class="sidebar-link">How to design a UX Portfolio website</a></li><li><a href="/blog/elegant-typefaces-for-the-web.html" class="sidebar-link">5 Elegant free typefaces for the web</a></li><li><a href="/blog/how-to-make-a-bar-chart-using-vue-js.html" class="sidebar-link">How to make a bar chart using Vue.js</a></li><li><a href="/blog/sync-data-from-firebase-to-google-sheets.html" aria-current="page" class="active sidebar-link">Sync data from Firebase to Google sheets</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/how-to-make-a-pie-chart-using-vue-js.html" class="sidebar-link">How to make a pie chart using Vue.js</a></li></ul> </div> <main class="page"> <header class="theme-default-content header"><h1>Sync data from Firebase to Google sheets</h1> <div class="post-meta">
      May 26, 2020 — 7 min read
    </div> <!----> <!----></header> <div class="theme-default-content content__default"><p>In one of my earlier posts I have described how to sync data from <a href="https://websiddu.com/blog/sync-google-sheets-to-firebase.html" target="_blank" rel="noopener noreferrer">Google sheets to Firebase<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. In some cases we need the inverse i.e Firebase → Google Sheets. Firebase is extremely powerful and very approachable to do such kinds of manipulations.</p> <img src="/img/blog/13/demo.gif" alt="demo" class="bordered"> <p>In this blog post I will describe how to sync new data written to a Firebase database to a Google Sheet. It includes a method for obtaining, storing, and using Oauth2 tokens for Google API access.</p> <h3 id="related-articles"><a href="#related-articles" class="header-anchor">#</a> Related articles</h3> <ul><li><a href="https://websiddu.com/blog/sync-google-sheets-to-firebase.html" target="_blank" rel="noopener noreferrer">Google Sheets --&gt; Firebase Realtime Database<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="step-1-create-your-firebase-project"><a href="#step-1-create-your-firebase-project" class="header-anchor">#</a> Step 1: Create your Firebase project</h3> <p>If you haven’t already, sign up for Firebase using the free tier and then create your project.</p> <p><img src="https://res.cloudinary.com/websiddu/image/upload/v1593528040/blog/013/new-project.png" alt="New project"></p> <div class="custom-block warning"><p class="custom-block-title">NOTE</p> <p>Firebase billing is required for cloud functions to work. You can easily upgrade to <code>Pay as you go</code>, just click on the upgrade button on the bottom of the sidebar.</p></div> <h3 id="step-2-enable-google-sheets-api"><a href="#step-2-enable-google-sheets-api" class="header-anchor">#</a> Step 2: Enable Google Sheets API</h3> <ul><li>Go to the <a href="https://console.developers.google.com/" target="_blank" rel="noopener noreferrer">API Console<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>From the projects list, select the newly created Firebase project.</li> <li>If the APIs &amp; services page isn't already open, open the console left side menu and select APIs &amp; services, and then select Library.</li> <li>Click on Enable APIs and search for Google Sheets. Or you can access the page <a href="https://console.developers.google.com/apis/library/sheets.googleapis.com?project=" target="_blank" rel="noopener noreferrer">directly<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li>Click ENABLE.</li></ul> <p><img src="https://res.cloudinary.com/websiddu/image/upload/v1593528481/blog/013/enable.png" alt="Enable"></p> <h3 id="step-2-create-a-service-account-in-your-project"><a href="#step-2-create-a-service-account-in-your-project" class="header-anchor">#</a> Step 2: Create a service account in your project</h3> <p>A service account is used in an application that calls APIs on behalf of an application that does not access user information. This type of application needs to prove its own identity, but it does not need a user to authorize requests.</p> <ul><li>Open the <a href="https://console.developers.google.com/apis/credentials" target="_blank" rel="noopener noreferrer">API Console Credentials<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> page.</li> <li>If it's not already selected, select the project that you're creating credentials for.</li> <li>To set up a new service account, click <code>New credentials</code> and then select Service account.</li> <li>Enter the name for your service account and clear description.</li></ul> <p><img src="https://res.cloudinary.com/websiddu/image/upload/v1593529518/blog/013/2.1.png" alt="Enter name &amp; description"></p> <ul><li>Click continue on <strong>Service account permissions</strong> as its optional.</li> <li>Click on <strong>Done</strong> on Grant users access to this service account.</li> <li>You will be lated back onto your credentials page and in the <strong>Service Accounts</strong> section click on the newly created account.</li> <li>In order to download the Service Account you have create a key, you can do that be selecting <strong>Add key</strong> button in the Service account details page.</li></ul> <p><img src="https://res.cloudinary.com/websiddu/image/upload/v1593529519/blog/013/2.3.png" alt="Select add key"></p> <ul><li>Choose JSON and click on <strong>Create</strong> in the dialog.</li> <li>Store the downloaded JSON file in a safe location.</li></ul> <h3 id="step-3-create-a-spreadsheet"><a href="#step-3-create-a-spreadsheet" class="header-anchor">#</a> Step 3: Create a spreadsheet</h3> <p>Now create a new Google Sheet in which you would be storing your data. You can quickly create a new sheet by accessing <a href="https://sheets.new" target="_blank" rel="noopener noreferrer">sheets.new<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Grab the id of the sheet.</p> <p><img src="https://res.cloudinary.com/websiddu/image/upload/v1593530093/blog/013/sheet.png" alt="Sheet"></p> <p>Share this sheet the email address in your service account and give edit access to the same. In this case I have to give edit access to the email address <code>firebase-to-sheets@fir-to-sheets-289e1.iam.gserviceaccount.com</code>.</p> <div class="custom-block tip"><p class="custom-block-title">IMPORTANT</p> <p>It's important that you share your Spreadsheet with the service account, otherwise the cloud function will not be able to write to the sheet.</p></div> <h3 id="step-4-setup-cloud-functions-project"><a href="#step-4-setup-cloud-functions-project" class="header-anchor">#</a> Step 4: Setup cloud functions project</h3> <p>For this you are expected to know how to use and setup a node js project along with a good understanding of firebase command line tools. To begin create a folder and run npm init</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> firebase-to-sheets
<span class="token builtin class-name">cd</span> firebase-to-sheets
<span class="token function">npm</span> init
</code></pre></div><p>Answer the scaffold questions and you will be ended up with a project and just a package.json file.</p> <p>Once that is done we have to initiate firebase. If you haven't already setup <a href="https://firebase.google.com/docs/cli" target="_blank" rel="noopener noreferrer">Firebase CLI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> this is required to deploy our cloud functions. Here is the <a href="https://github.com/firebase/firebase-tools" target="_blank" rel="noopener noreferrer">github page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> if you need more help.</p> <p>Assuming you have already setup firebase cli and logged into firebase, you can run the following command to init a firebase project and then select functions only and hit enter.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>firebase init --project fir-to-sheets-289e1
</code></pre></div><p>You have to replace <code>fir-to-sheets-289e1</code> with your own project id. You can find the project id in your firebase console. Or you can simply run <code>firebase init</code> and select the project from the list.</p> <p><img src="https://res.cloudinary.com/websiddu/image/upload/v1593531424/blog/013/fb-cli.png" alt="Firebase cli"></p> <p>Follow through the questioner and select Javascript when prompted for language choice. Next open up the project in VS Code.</p> <h3 id="step-5-install-dependencies-write-code"><a href="#step-5-install-dependencies-write-code" class="header-anchor">#</a> Step 5: Install dependencies &amp; write code</h3> <p>Cloud functions here are going to interact with the Google API using the service account and write data to the Sheets. So lets install the required dependencies in the functions folder</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> firebase-admin firebase-functions googleapis@34 lodash --save
</code></pre></div><p>This will install the required dependence for our code.</p> <p>Once that is done move your downloaded service account json file to <code>functions</code> folder. And copy the following code to your <code>functions/index.js</code> file. Replace your <code>YOUR_SPREADSHEET_ID_HERE</code> with your sheets id and also rename <code>serviceAccount.json</code> the file name of your choice.</p> <div class="filename">functions/index.js</div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> functions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;firebase-functions&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> google <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;googleapis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sheets <span class="token operator">=</span> google<span class="token punctuation">.</span><span class="token function">sheets</span><span class="token punctuation">(</span><span class="token string">&quot;v4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> spreadsheetId <span class="token operator">=</span> <span class="token string">&quot;YOUR_SPREADSHEET_ID_HERE&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serviceAccount <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./serviceAccount.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> jwtClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>JWT</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  email<span class="token operator">:</span> serviceAccount<span class="token punctuation">.</span>client_email<span class="token punctuation">,</span>
  key<span class="token operator">:</span> serviceAccount<span class="token punctuation">.</span>private_key<span class="token punctuation">,</span>
  scopes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://www.googleapis.com/auth/spreadsheets&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> jwtAuthPromise <span class="token operator">=</span> jwtClient<span class="token punctuation">.</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>SyncToSheets <span class="token operator">=</span> functions<span class="token punctuation">.</span>database
  <span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;/products&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">onUpdate</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">change</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> jsonData <span class="token operator">=</span> change<span class="token punctuation">.</span>after<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> jwtAuthPromise<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">flatten</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token function-variable function">recurse</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cur<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Object</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span> <span class="token operator">!==</span> cur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> cur<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token function">recurse</span><span class="token punctuation">(</span>cur<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> prop <span class="token operator">+</span> <span class="token string">&quot;[&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> result<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> isEmpty <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> p <span class="token keyword">in</span> cur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            isEmpty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token function">recurse</span><span class="token punctuation">(</span>cur<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">,</span> prop <span class="token operator">?</span> prop <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> p <span class="token operator">:</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>isEmpty <span class="token operator">&amp;&amp;</span> prop<span class="token punctuation">)</span> result<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">recurse</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> allKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> firstElement <span class="token operator">=</span> allKeys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> headerData <span class="token operator">=</span> <span class="token function">flatten</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">[</span>firstElement<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>headerData<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> rows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">in</span> jsonData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span> jsonData<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> row <span class="token operator">=</span> <span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">;</span>
      keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        row<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rows<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> sheetData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token operator">...</span>keys<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span>rows<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Products!A1:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>
      <span class="token number">65</span> <span class="token operator">+</span> keys<span class="token punctuation">.</span>length
    <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>allKeys<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> sheets<span class="token punctuation">.</span>spreadsheets<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>
        auth<span class="token operator">:</span> jwtClient<span class="token punctuation">,</span>
        spreadsheetId<span class="token operator">:</span> spreadsheetId<span class="token punctuation">,</span>
        range<span class="token operator">:</span> range<span class="token punctuation">,</span>
        valueInputOption<span class="token operator">:</span> <span class="token string">&quot;RAW&quot;</span><span class="token punctuation">,</span>
        requestBody<span class="token operator">:</span> <span class="token punctuation">{</span> values<span class="token operator">:</span> sheetData <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can replace <code>products</code> with your own database path and also change the name <code>Products</code> in the range variable.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The piece of code <code>String.fromCharCode(65 + keys.length)</code> will only work for 26 column names, if you have more than 26 columns you have to create your own log to replicate the Google Sheets algorithm of range generation.</p></div> <h3 id="step-6-deploy"><a href="#step-6-deploy" class="header-anchor">#</a> Step 6: Deploy</h3> <p>Now you can deploy the cloud functions using the deploy command. From within the functions folder run the following command</p> <div class="language-shell extra-class"><pre class="language-shell"><code>firebase deploy --only functions
</code></pre></div><p>Once the functions are deployed any change you make to the firebase database will be updated to the Google Sheets immediately.</p> <h3 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h3> <br> <video controls="controls" autoplay="autoplay"><source src="/img/blog/13/demo.mp4" type="video/mp4"> <source src="movie.ogg" type="video/ogg">
  Your browser does not support the video tag.
</video> <p>If you feel fancy you can auto create the sheets based on the endpoint if you use a wildcard reference to the database path. You can refer to the <a href="https://developers.google.com/sheets/api/guides/batchupdate" target="_blank" rel="noopener noreferrer">Google Sheets API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> documentation and tailor this to your needs.</p> <p>If you like the post please feel free to share it with on twitter or leave a comment below. If you found any errors in this article, please feel free to edit on <a href="https://github.com/websiddu/websiddu/blob/master/blog/posts/013-sync-firebase-to-google-sheets.md" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="references"><a href="#references" class="header-anchor">#</a> References</h3> <ul><li><a href="https://gist.github.com/CodingDoug/ffc4f050cc489a0280eb7f4cbe36af07" target="_blank" rel="noopener noreferrer">Copying data from Firebase to a Google Sheet via Cloud Functions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developers.google.com/sheets/api/guides/concepts" target="_blank" rel="noopener noreferrer">Google Sheets API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://firebase.google.com/docs/functions/" target="_blank" rel="noopener noreferrer">Firebase functions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div><div class="page-edit"><div class="page-share"><svg viewBox="0 0 39 32" class="Icon"><g id="icon-twitter-bird"><path fill="#55acee" d="M34.7 5c1.7-1 2.8-2.5 3.4-4.4-1.6 0.9-3.3 1.6-5 2-1.6-1.7-3.6-2.6-5.8-2.6-2.2 0-4.2 0.7-5.7 2.3-1.6 1.6-2.3 3.4-2.3 5.8 0 0.6 0.1 1.2 0.2 1.8-6.9-0.4-12.6-3.2-16.9-8.5-0.7 1.2-1.1 2.7-1.1 4.1 0 3 1.2 5.2 3.6 6.8-1.2 0-2.5-0.4-3.6-1v0.1c0 2 0.6 3.7 1.8 5.2 1.2 1.5 2.7 2.5 4.6 2.8-0.6 0.1-1.2 0.2-2.1 0.2-0.4 0-0.9 0-1.5-0.1 0.5 1.5 1.4 2.8 2.8 3.8 1.4 1 3 1.5 4.7 1.6-3.1 2.5-6.4 3.7-10 3.7-0.5 0-1.1 0-2-0.1 3.7 2.2 7.8 3.4 12.4 3.4 3.6 0 6.8-0.7 9.8-2.1 3-1.4 5.4-3.2 7.3-5.4 1.8-2.2 3.3-4.7 4.3-7.4s1.6-5.4 1.6-8.1v-1c1.4-1 2.7-2.5 3.9-4.2-1.6 0.6-3.2 1.1-4.7 1.2z"></path></g></svg> <div>
        If you liked this article and think others should read it, please
        <a href="http://twitter.com/share?text=Sync data from Firebase to Google sheets&amp;url=https://websiddu.com//blog/sync-data-from-firebase-to-google-sheets.html&amp;via=websiddu" target="_blank">
          share it on Twitter
        </a></div></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <br> <span class="time">9/4/2020, 2:05:38 AM</span></div></div> <div class="page-comments"><!----> <br></div></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←

      <a href="/blog/how-to-make-a-pie-chart-using-vue-js.html" class="prev">How to make a pie chart using Vue.js</a></span> <span class="next"><a href="/blog/how-to-make-a-bar-chart-using-vue-js.html">How to make a bar chart using Vue.js</a>
      →
    </span></p></div> </main> <footer data-v-2531d917><div class="footer-content" data-v-2531d917><nav class="nav-links" data-v-2531d917><div class="nav-item" data-v-2531d917><a href="https://twitter.com/websiddu" target="_blank" class="nav-link" data-v-2531d917>Twitter</a></div> <div class="nav-item" data-v-2531d917><a href="https://github.com/websiddu" target="_blank" class="nav-link" data-v-2531d917>Github</a></div> <div class="nav-item" data-v-2531d917><a href="https://github.com/websiddu/websiddu" target="_blank" class="nav-link" data-v-2531d917>Source</a></div> <div class="nav-item" data-v-2531d917><a href="https://websiddu.com/feed.atom" target="_blank" class="nav-link" data-v-2531d917>Feed</a></div> <div class="nav-spacer" data-v-2531d917></div> <div class="nav-item" data-v-2531d917><a href="/blog" class="nav-link router-link-active" data-v-2531d917>Articles</a></div> <div class="nav-item" data-v-2531d917><a href="/photos" class="nav-link" data-v-2531d917>Photos</a></div> <div class="nav-item" data-v-2531d917><a href="/projects.html" class="nav-link" data-v-2531d917>Projects</a></div> <div class="nav-item" data-v-2531d917><a href="/about.html" class="nav-link" data-v-2531d917>About</a></div></nav></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.da7058d1.js" defer></script><script src="/assets/js/2.faa5509e.js" defer></script><script src="/assets/js/35.ba935731.js" defer></script><script src="/assets/js/20.e440b549.js" defer></script>
  </body>
</html>
